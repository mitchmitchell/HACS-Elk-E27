{"run_id": "a0d19b3f0a014d9c9a99efcb6e235e2f", "test_id": "test/test_live_e27_users_download.py::test_live_users_download", "record_type": "test_start", "t_ms": 0, "ts_utc": "2026-01-04T05:34:06Z", "meta": {"pid": 62533}}
{"run_id": "a0d19b3f0a014d9c9a99efcb6e235e2f", "test_id": "test/test_live_e27_users_download.py::test_live_users_download", "record_type": "test_end", "t_ms": 10326, "ts_utc": "2026-01-04T05:34:16Z", "outcome": "fail", "error": {"when": "call", "longrepr": "live_e27_client = <elke27_lib.client.Elke27Client object at 0x10c3d4830>\n\n    @pytest.mark.live_e27\n    @pytest.mark.asyncio\n    async def test_live_users_download(live_e27_client: Elke27Client) -> None:\n        pin = _get_pin()\n        kernel = live_e27_client._kernel\n        original_on_message = kernel._on_message\n    \n        def _log_on_message(msg):\n            LOG.debug(\"raw inbound msg=%r\", msg)\n            return original_on_message(msg)\n    \n        kernel._on_message = _log_on_message\n        try:\n            auth_result = await live_e27_client.async_execute(\"control_authenticate\", pin=pin)\n            LOG.debug(\n                \"control.authenticate result ok=%s data=%r error=%s\",\n                auth_result.ok,\n                auth_result.data,\n                auth_result.error,\n            )\n            if not auth_result.ok:\n                pytest.fail(f\"control.authenticate failed: {describe_error(auth_result.error)}\")\n    \n            configured = await live_e27_client.async_execute(\"user_get_configured\", timeout_s=_LIVE_TIMEOUT_S)\n            if not configured.ok:\n                if extract_error_code(configured.error) == E27ErrorCode.ELKERR_NOT_READY:\n                    pytest.skip(\"Panel reported not-ready for user_get_configured.\")\n                pytest.fail(f\"user_get_configured failed: {describe_error(configured.error)}\")\n    \n            user_ids = configured.data.get(\"users\") if configured.data else None\n            if not isinstance(user_ids, list):\n                pytest.skip(\"No configured users reported.\")\n    \n            user_ids = [user_id for user_id in user_ids if isinstance(user_id, int) and user_id >= 1]\n            if not user_ids:\n                pytest.skip(\"No configured users reported.\")\n    \n            last_error = None\n            for user_id in user_ids:\n                auth_result = await live_e27_client.async_execute(\"control_authenticate\", pin=pin)\n                LOG.debug(\n                    \"control.authenticate (per-user) ok=%s data=%r error=%s\",\n                    auth_result.ok,\n                    auth_result.data,\n                    auth_result.error,\n                )\n                if not auth_result.ok:\n                    pytest.fail(f\"control.authenticate failed: {describe_error(auth_result.error)}\")\n    \n                result = await live_e27_client.async_execute(\n                    \"user_get_attribs\",\n                    user_id=user_id,\n                    pin=str(pin),\n                    timeout_s=_LIVE_TIMEOUT_S,\n                )\n                if not result.ok:\n                    code = extract_error_code(result.error)\n                    if code == E27ErrorCode.ELKERR_NOT_READY:\n                        pytest.skip(\"Panel reported not-ready for user_get_attribs.\")\n                    if code == E27ErrorCode.ELKERR_NOAUTH:\n                        pytest.fail(f\"user_get_attribs rejected after authenticate: {describe_error(result.error)}\")\n                    last_error = result.error\n                    continue\n                if result.ok:\n                    user = live_e27_client._kernel.state.users.get(user_id)\n                    if user is not None:\n                        return\n    \n            if last_error is not None:\n>               pytest.fail(f\"User attribs unavailable after authenticate: {describe_error(last_error)}\")\nE               Failed: User attribs unavailable after authenticate: Authorization is required for this operation.\n\ntest/test_live_e27_users_download.py:106: Failed"}}
